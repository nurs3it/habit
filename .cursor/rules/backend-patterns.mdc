---
description: FastAPI и MongoDB паттерны
globs: backend/**/*.py
alwaysApply: false
---

# Backend Patterns

## FastAPI структура

- Использовать async/await для всех операций с БД
- Разделять роуты по модулям в `app/api/v1/`
- Использовать Pydantic схемы для валидации
- Использовать зависимости для аутентификации

## MongoDB

- Использовать Motor (async MongoDB driver)
- Всегда проверять существование документов перед операциями
- Использовать ObjectId для идентификаторов
- Обрабатывать ошибки при работе с БД

## Обработка ошибок

- Использовать HTTPException для ошибок API
- Возвращать правильные HTTP статус коды
- Валидировать входные данные через Pydantic

## Примеры

```python
# ✅ GOOD
@router.get("/{item_id}")
async def get_item(item_id: str, current_user: User = Depends(get_current_user)):
    item = await db.items.find_one({"_id": ObjectId(item_id), "user_id": current_user.id})
    if not item:
        raise HTTPException(status_code=404, detail="Item not found")
    return ItemResponse(**item)

# ❌ BAD
@router.get("/{item_id}")
async def get_item(item_id: str):
    item = await db.items.find_one({"_id": item_id})
    return item
```
